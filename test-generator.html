<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Generator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #0f0f23; color: white; }
        .test { margin: 10px 0; padding: 10px; background: #1a1a2e; border-radius: 5px; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        button { padding: 8px 16px; margin: 5px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; background: #111827; color: white; border: 1px solid #374151; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Test Generator - Naprawy</h1>
    
    <div class="test">
        <h3>Test 1: Generowanie PESEL</h3>
        <input type="number" id="testDay" placeholder="Dzień" min="1" max="31" value="15">
        <input type="number" id="testMonth" placeholder="Miesiąc" min="1" max="12" value="6">
        <input type="number" id="testYear" placeholder="Rok" min="1900" max="2024" value="1990">
        <select id="testSex">
            <option value="M">Mężczyzna</option>
            <option value="K">Kobieta</option>
        </select>
        <button onclick="testPesel()">Generuj PESEL</button>
        <div>PESEL: <span id="peselResult"></span></div>
    </div>
    
    <div class="test">
        <h3>Test 2: Upload zdjęcia</h3>
        <input type="file" id="testFile" accept="image/*">
        <button onclick="testImageUpload()">Test Upload</button>
        <div>Status: <span id="uploadResult"></span></div>
        <img id="testImage" style="max-width: 200px; display: none;">
    </div>
    
    <div class="test">
        <h3>Test 3: Generowanie dat dokumentu</h3>
        <button onclick="testDates()">Generuj daty</button>
        <div>Data wydania: <span id="givenDateResult"></span></div>
        <div>Termin ważności: <span id="expiryDateResult"></span></div>
    </div>

    <script>
        // Kopiuj funkcje z generator.html
        function generatePesel() {
            const year = parseInt(document.getElementById('testYear').value);
            const month = parseInt(document.getElementById('testMonth').value);
            const day = parseInt(document.getElementById('testDay').value);
            const sex = document.getElementById('testSex').value;
            
            if (!year || !month || !day || !sex) return '';
            
            const date = new Date(year, month - 1, day);
            if (date.getFullYear() !== year || date.getMonth() !== month - 1 || date.getDate() !== day) {
                return "Nieprawidłowa data";
            }
            
            let monthInPesel = month;
            if (year >= 2000 && year < 2100) monthInPesel += 20;
            else if (year >= 2100 && year < 2200) monthInPesel += 40;
            else if (year >= 2200 && year < 2300) monthInPesel += 60;
            else if (year >= 1800 && year < 1900) monthInPesel += 80;
            
            const yearStr = String(year).slice(-2).padStart(2, '0');
            const monthStr = String(monthInPesel).padStart(2, '0');
            const dayStr = String(day).padStart(2, '0');
            const randomDigits = String(Math.floor(Math.random() * 999)).padStart(3, '0');
            const sexDigit = sex === 'M' ? 
                String(2 * Math.floor(Math.random() * 5) + 1) : 
                String(2 * Math.floor(Math.random() * 5));
            
            const peselWithoutChecksum = yearStr + monthStr + dayStr + randomDigits + sexDigit;
            const weights = [1, 3, 7, 9, 1, 3, 7, 9, 1, 3];
            let sum = 0;
            
            for (let i = 0; i < 10; i++) {
                sum += parseInt(peselWithoutChecksum[i]) * weights[i];
            }
            
            const checksum = (10 - (sum % 10)) % 10;
            return peselWithoutChecksum + checksum;
        }
        
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }
        
        function testPesel() {
            const pesel = generatePesel();
            document.getElementById('peselResult').textContent = pesel;
            document.getElementById('peselResult').className = pesel.length === 11 ? 'success' : 'error';
        }
        
        function testImageUpload() {
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('uploadResult').textContent = 'Wybierz plik';
                document.getElementById('uploadResult').className = 'error';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = document.getElementById('testImage');
                img.src = event.target.result;
                img.style.display = 'block';
                document.getElementById('uploadResult').textContent = 'Upload udany!';
                document.getElementById('uploadResult').className = 'success';
            };
            reader.readAsDataURL(file);
        }
        
        function testDates() {
            const year = parseInt(document.getElementById('testYear').value);
            const month = parseInt(document.getElementById('testMonth').value);
            const day = parseInt(document.getElementById('testDay').value);
            
            if (!year || !month || !day) {
                document.getElementById('givenDateResult').textContent = 'Wprowadź datę urodzenia';
                return;
            }
            
            const birth = new Date(year, month - 1, day);
            const issuedDate = new Date(birth.getTime());
            issuedDate.setDate(issuedDate.getDate() + 4);
            
            const expDate = new Date(issuedDate.getTime());
            expDate.setFullYear(issuedDate.getFullYear() + 5);
            
            document.getElementById('givenDateResult').textContent = formatDate(issuedDate);
            document.getElementById('expiryDateResult').textContent = formatDate(expDate);
        }
        
        // Auto test
        window.onload = function() {
            testPesel();
            testDates();
        };
    </script>
</body>
</html>